!function(){"use strict";console.log("üîß ROBUST INIT: Starting comprehensive initialization system");const e={isResetChatHistory:!1,local_folders:[],conversations:[],userFolders:[],prompts:[],isPremiumUser:!0,isPremium:!0,userPlan:"premium",subscriptionStatus:"active",DEV_MODE_PREMIUM:!0,MOCK_PREMIUM:!0,premiumStatus:{active:!0,plan:"Premium",features:["manage_chats","manage_folders","manage_prompts"]},DEV_MODE_CONFIG:{MOCK_PREMIUM:!0,LOCAL_ONLY_MODE:!0,BLOCK_EXTERNAL_APIS:!0,ENABLE_DEBUG_LOGGING:!0},MOCK_BACKEND:{enabled:!0,mockResponses:!0,shouldMock:function(e){return e.includes("api.infi-dev.com")||e.includes("example-removed")||e.includes("infi-dev")||e.includes("lemonsqueezy.com")},getMockResponse:function(e){return e.includes("/auth/generate-jwt")?{jwt:"mock.jwt.token.for.local.development",success:!0}:e.includes("/folder/")||e.includes("/conversation/")?[]:{success:!0,mocked:!0}}}};Object.keys(e).forEach(o=>{if(!(o in window))try{Object.defineProperty(window,o,{value:e[o],writable:!0,enumerable:!0,configurable:!0}),console.log(`‚úÖ ROBUST INIT: Defined ${o}`)}catch(n){console.warn(`‚ö†Ô∏è ROBUST INIT: Failed to define ${o}:`,n);try{window[o]=e[o],console.log(`‚úÖ ROBUST INIT: Fallback assignment for ${o}`)}catch(e){console.error(`‚ùå ROBUST INIT: Complete failure for ${o}:`,e)}}}),window.safeGetProperty=function(e,o,n=null){try{return null==e?("isResetChatHistory"!==o&&"isPremium"!==o&&"local_folders"!==o&&console.warn(`üõ°Ô∏è SAFE ACCESS: Object is null/undefined for property: ${o}`),n):o in e?e[o]:("isResetChatHistory"!==o&&"isPremium"!==o&&"local_folders"!==o&&console.warn(`üõ°Ô∏è SAFE ACCESS: Property ${o} not found in object`),n)}catch(e){return console.warn(`üõ°Ô∏è SAFE ACCESS: Error accessing ${o}:`,e),n}},window.safeHasProperty=function(e,o){try{return null==e?("isResetChatHistory"!==o&&"isPremium"!==o&&"local_folders"!==o&&console.warn(`üõ°Ô∏è SAFE IN: Object is null/undefined for property: ${o}`),!1):o in e}catch(e){return console.warn(`üõ°Ô∏è SAFE IN: Error checking property ${o}:`,e),!1}};const o={isReady:function(){return"loading"!==document.readyState},isBodyReady:function(){return!(!document.body||document.body.nodeType!==Node.ELEMENT_NODE)},whenReady:function(e,o=10,n=100){let r=0;const s=()=>{if(this.isReady()&&this.isBodyReady())try{e(),console.log("‚úÖ DOM UTILS: Callback executed successfully")}catch(e){console.error("‚ùå DOM UTILS: Callback error:",e)}else r<o?(r++,console.log(`üîÑ DOM UTILS: Retry ${r}/${o} - DOM not ready`),setTimeout(s,n*r)):console.error("‚ùå DOM UTILS: Max retries reached, DOM still not ready")};s()},whenBodyReady:function(e,o=20,n=50){let r=0;const s=()=>{if(this.isBodyReady())try{e(),console.log("‚úÖ DOM UTILS: Body callback executed successfully")}catch(e){console.error("‚ùå DOM UTILS: Body callback error:",e)}else if(r<o)r++,console.log(`üîÑ DOM UTILS: Body retry ${r}/${o}`),setTimeout(s,n*r);else{console.error("‚ùå DOM UTILS: Max body retries reached");try{e()}catch(e){console.error("‚ùå DOM UTILS: Last resort callback failed:",e)}}};s()}};window.domUtils=o;const n={isAvailable:function(){return!!(window.chrome&&window.chrome.storage&&window.chrome.storage.local)},safeGet:async function(e,o={}){try{if(!this.isAvailable())return console.warn("üîß STORAGE: Chrome storage not available, using defaults"),o;const n=await chrome.storage.local.get(e);return console.log("‚úÖ STORAGE: Retrieved data successfully"),{...o,...n}}catch(e){return console.error("‚ùå STORAGE: Get error:",e),o}},safeSet:async function(e){try{return this.isAvailable()?(await chrome.storage.local.set(e),console.log("‚úÖ STORAGE: Data saved successfully"),!0):(console.warn("üîß STORAGE: Chrome storage not available, skipping set"),!1)}catch(e){return console.error("‚ùå STORAGE: Set error:",e),!1}}};window.storageUtils=n;const r=window.onerror;window.onerror=function(o,n,s,t,i){if(o&&o.includes("Cannot read properties of undefined")){console.warn("üõ°Ô∏è ROBUST INIT: Intercepted undefined property access:",o);const n=o.match(/Cannot read properties of undefined \(reading '(\w+)'\)/);if(n&&n[1]){const o=n[1];void 0===e[o]||o in window||(window[o]=e[o],console.log(`üõ°Ô∏è ROBUST INIT: Emergency fallback set for ${o}`))}return!0}if(r)return r.apply(this,arguments)},window.addEventListener("unhandledrejection",function(e){console.warn("üõ°Ô∏è ROBUST INIT: Unhandled promise rejection:",e.reason),e.reason&&"object"==typeof e.reason&&(e.reason.message&&e.reason.message.includes("isResetChatHistory")&&(console.log("üõ°Ô∏è ROBUST INIT: Handling isResetChatHistory rejection"),e.preventDefault()),e.reason.message&&e.reason.message.includes("local_folders")&&(console.log("üõ°Ô∏è ROBUST INIT: Handling local_folders rejection"),e.preventDefault()))}),Object.defineProperty(window,"ROBUST_INIT_COMPLETE",{value:!0,writable:!1,enumerable:!0,configurable:!1}),console.log("‚úÖ ROBUST INIT: Comprehensive initialization system ready"),console.log("üîß ROBUST INIT: Properties defined, DOM utils available, error handling active")}();