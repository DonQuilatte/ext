if("undefined"!=typeof chrome&&chrome.storage){const e=chrome.storage.local.get;chrome.storage.local.get=function(t,o){return o?e.call(this,t,e=>{const a=e||{};"string"==typeof t?void 0===a[t]&&(a[t]=getDefaultValue(t)):Array.isArray(t)&&t.forEach(e=>{void 0===a[e]&&(a[e]=getDefaultValue(e))}),o(a)}):e.call(this,t).then(e=>{const o=e||{};return"string"==typeof t?void 0===o[t]&&(o[t]=getDefaultValue(t)):Array.isArray(t)&&t.forEach(e=>{void 0===o[e]&&(o[e]=getDefaultValue(e))}),o})}}function getDefaultValue(e){return{isResetChatHistory:!1,local_folders:[],local_prompts:[],local_chains:[],local_pinned:[],local_announcements:[],local_user_data:{isPaid:!0,accountId:"local-user"},store:{selectedItems:[],selectedManageTabsItem:"ACTIVE_CHATS",selectedModalType:void 0,sidebarClickListenerAdded:!1,folders:[],selectedFolder:void 0,injectedTabs:!1,prompts:[],chains:[],pinnedChats:{},pinnedFolders:{},direction:"ltr",GPTs:[],sharedGPTs:[]}}[e]||null}async function initializeCriticalStorage(){if("undefined"==typeof chrome||!chrome.storage)return void console.warn("Chrome storage API not available");const e={isResetChatHistory:!1,local_folders:[],local_prompts:[],local_chains:[],local_pinned:[],local_announcements:[],local_user_data:{isPaid:!0,accountId:"local-user"},store:{selectedItems:[],selectedManageTabsItem:"ACTIVE_CHATS",selectedModalType:void 0,sidebarClickListenerAdded:!1,folders:[],selectedFolder:void 0,injectedTabs:!1,prompts:[],chains:[],pinnedChats:{},pinnedFolders:{},direction:"ltr",GPTs:[],sharedGPTs:[]}};try{const t=await chrome.storage.local.get(null),o={};for(const[a,r]of Object.entries(e))t&&"object"==typeof t&&t.hasOwnProperty(a)&&void 0!==t[a]&&null!==t[a]||(o[a]=r);Object.keys(o).length>0&&(await chrome.storage.local.set(o),console.log("ðŸ”§ SAFE STORAGE: Initialized missing storage keys:",Object.keys(o)))}catch(e){console.error("ðŸš¨ SAFE STORAGE: Failed to initialize storage:",e)}}window.safeStorageGet=async function(e,t=null){try{const o=await chrome.storage.local.get(e);return o&&void 0!==o[e]?o[e]:t}catch(o){return console.warn(`ðŸš¨ SAFE STORAGE: Failed to get ${e}:`,o),t}},window.safeStorageSet=async function(e,t){try{return await chrome.storage.local.set({[e]:t}),!0}catch(t){return console.error(`ðŸš¨ SAFE STORAGE: Failed to set ${e}:`,t),!1}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeCriticalStorage):initializeCriticalStorage(),"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getManifest&&initializeCriticalStorage(),console.log("ðŸ”§ SAFE STORAGE: Wrapper initialized");